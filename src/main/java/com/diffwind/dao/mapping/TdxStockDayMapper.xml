<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.diffwind.dao.mapper.TdxStockDayMapper" >
  <resultMap id="BaseResultMap" type="com.diffwind.dao.model.TdxStockDay" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <result column="symbol" property="symbol" jdbcType="CHAR" />
    <result column="date" property="date" jdbcType="DATE" />
    <result column="open" property="open" jdbcType="DOUBLE" />
    <result column="high" property="high" jdbcType="DOUBLE" />
    <result column="low" property="low" jdbcType="DOUBLE" />
    <result column="close" property="close" jdbcType="DOUBLE" />
    <result column="amt" property="amt" jdbcType="DOUBLE" />
    <result column="vol" property="vol" jdbcType="DOUBLE" />
  </resultMap>
  <insert id="insert" parameterType="com.diffwind.dao.model.TdxStockDay" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into tdx_stock_day (symbol, date, open, 
      high, low, close, amt, 
      vol)
    values (#{symbol,jdbcType=CHAR}, #{date,jdbcType=DATE}, #{open,jdbcType=DOUBLE}, 
      #{high,jdbcType=DOUBLE}, #{low,jdbcType=DOUBLE}, #{close,jdbcType=DOUBLE}, #{amt,jdbcType=DOUBLE}, 
      #{vol,jdbcType=DOUBLE})
  </insert>
  <select id="selectAll" resultMap="BaseResultMap" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select symbol, date, open, high, low, close, amt, vol
    from tdx_stock_day
  </select>
  
  
  <insert id="batchInsert" parameterType="map">
    insert into tdx_stock_day (symbol, date, open, 
      high, low, close, amt, 
      vol)
    values 
    <foreach collection="records" item="item" index="index" separator=",">
      (#{item.symbol,jdbcType=CHAR}, #{item.date,jdbcType=DATE}, #{item.open,jdbcType=DOUBLE}, 
      #{item.high,jdbcType=DOUBLE}, #{item.low,jdbcType=DOUBLE}, #{item.close,jdbcType=DOUBLE}, #{item.amt,jdbcType=DOUBLE}, 
      #{item.vol,jdbcType=DOUBLE})
    </foreach>
  </insert>
  
  
   <!-- 剔除停牌 -->
  <select id="selectBySymbol" resultMap="BaseResultMap" parameterType="map" >
    select symbol, date, open, high, low, close, amt, vol
    from tdx_stock_day
    where symbol = #{symbol}
    and cast(vol as numeric) > 0
    <if test="isDesc == true">  
    order by date desc
    </if>
    <if test="isDesc == false">  
    order by date
    </if>
  </select>
  
  
  <!-- 分区表 -->
  <insert id="batchInsertPartition" parameterType="map">
    insert into "tdx_stock_day_${partition}" (symbol, date, open, 
      high, low, close, amt, 
      vol)
    values 
    <foreach collection="records" item="item" index="index" separator=",">
      (#{item.symbol,jdbcType=CHAR}, #{item.date,jdbcType=DATE}, #{item.open,jdbcType=DOUBLE}, 
      #{item.high,jdbcType=DOUBLE}, #{item.low,jdbcType=DOUBLE}, #{item.close,jdbcType=DOUBLE}, #{item.amt,jdbcType=DOUBLE}, 
      #{item.vol,jdbcType=DOUBLE})
    </foreach>
  </insert>
  
  <delete id="truncatePartition" statementType="STATEMENT" parameterType="map">
    truncate table "tdx_stock_day_${partition}"
  </delete>

</mapper>