<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.diffwind.dao.mapper.XueqiuStockShareschgMapper" >
  <resultMap id="BaseResultMap" type="com.diffwind.dao.model.XueqiuStockShareschg" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <result column="symbol" property="symbol" jdbcType="CHAR" />
    <result column="publishdate" property="publishdate" jdbcType="DATE" />
    <result column="begindate" property="begindate" jdbcType="DATE" />
    <result column="totalshare" property="totalshare" jdbcType="DOUBLE" />
    <result column="totalsharechg" property="totalsharechg" jdbcType="DOUBLE" />
    <result column="skchgexp" property="skchgexp" jdbcType="VARCHAR" />
    <result column="fcircskamt" property="fcircskamt" jdbcType="DOUBLE" />
    <result column="circskamt" property="circskamt" jdbcType="DOUBLE" />
    <result column="ncircamt" property="ncircamt" jdbcType="DOUBLE" />
  </resultMap>
  <insert id="insert" parameterType="com.diffwind.dao.model.XueqiuStockShareschg" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into xueqiu_stock_shareschg (symbol, publishdate, begindate, 
      totalshare, totalsharechg, skchgexp, 
      fcircskamt, circskamt, ncircamt
      )
    values (#{symbol,jdbcType=CHAR}, #{publishdate,jdbcType=DATE}, #{begindate,jdbcType=DATE}, 
      #{totalshare,jdbcType=DOUBLE}, #{totalsharechg,jdbcType=DOUBLE}, #{skchgexp,jdbcType=VARCHAR}, 
      #{fcircskamt,jdbcType=DOUBLE}, #{circskamt,jdbcType=DOUBLE}, #{ncircamt,jdbcType=DOUBLE}
      )
  </insert>
  <select id="selectAll" resultMap="BaseResultMap" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select symbol, publishdate, begindate, totalshare, totalsharechg, skchgexp, fcircskamt, 
    circskamt, ncircamt
    from xueqiu_stock_shareschg
  </select>
  
  
  
  <select id="selectBySymbol" parameterType="java.lang.String" resultMap="BaseResultMap">
    select symbol, publishdate, begindate, totalshare, totalsharechg, skchgexp, fcircskamt, 
    circskamt, ncircamt
    from xueqiu_stock_shareschg
    where symbol = #{symbol}
    order by begindate desc
  </select>
  
    <!-- 查询所有股票最新的股本变更，须使用begindate排序。
    publishdate与begindate先后顺序不确定，可能先公告也可能后公告。因此不可使用publishdate。而且publishdate存在重复情况。 -->
  <select id="selectAllStkLastShareschg" resultMap="BaseResultMap">
  	select symbol, begindate 
	from (select *,row_number() over (partition by symbol order by begindate desc) rn from xueqiu_stock_shareschg) f 
	where rn=1
	order by symbol
  </select>
</mapper>